# Set your source and destination paths
$source_dir = "D:\GitHubRepos"
$backup_base_dir = "D:\CodeBackup"

# Create a timestamp for the backup folder name (e.g., 20250903_1048)
$timestamp = Get-Date -Format "yyyyMMdd_HHmm"
$destination_dir = Join-Path -Path $backup_base_dir -ChildPath $timestamp

# Create the new destination directory
New-Item -ItemType Directory -Path $destination_dir | Out-Null

# Use Robocopy for a fast and reliable copy
# The /MIR option mirrors the source to the destination.
# The /MT:16 option uses 16 threads for faster copying.
# The /Z option allows the copy to be restarted if interrupted.
# The /E option includes all subdirectories, including empty ones.
robocopy $source_dir $destination_dir /MIR /MT:16 /Z /E

Write-Host "Backup of $source_dir complete. Saved to $destination_dir"
