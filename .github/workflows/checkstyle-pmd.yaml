name: Checkstyle + PMD

on:
  push:
    branches: [main]

jobs:
  static-analysis:
    name: Static Code Analysis
    runs-on: windows-latest

    steps:
      - name: ðŸ“¥ Checkout Code
        uses: actions/checkout@v4

      # Setup Java
      - name: â˜• Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: List directory structure for debug
        run: dir /s /b
        shell: cmd

      ##########################
      # DOWNLOAD: Checkstyle
      ##########################
      - name: ðŸ“¦ Download Checkstyle
        run: |
          mkdir tools\checkstyle
          curl -L -o tools\checkstyle\checkstyle-10.26.1-all.jar https://github.com/checkstyle/checkstyle/releases/download/checkstyle-10.26.1/checkstyle-10.26.1-all.jar
      # move checkstyle.jar tools\checkstyle\checkstyle.jar

      ##########################
      # DOWNLOAD: PMD
      ##########################
      - name: ðŸ“¦ Download and Extract PMD
        run: curl -L -o pmd.zip https://github.com/pmd/pmd/releases/download/pmd_releases%2F7.15.0/pmd-dist-7.15.0-bin.zip
        shell: bash

      ##########################
      # EXTRACT: PMD ZIP
      ##########################
      - name: ðŸ“¦ Extract PMD ZIP
        run: |
          mkdir -p tools/pmd
          powershell -Command "Expand-Archive -Path 'pmd.zip' -DestinationPath 'tools/pmd'"
        shell: cmd

      ##########################
      # VERIFY DIRECTORY: PMD
      ##########################
      - name: ðŸ“¦ Verify PMD Directory
        run: dir /s /b tools\pmd
        shell: cmd

      ##########################
      # RUN: Checkstyle Analysis
      ##########################
      - name: ðŸ§¼ Run Checkstyle
        run: scripts\run-checkstyle.bat


      ##########################
      # RUN: Checkstyle Analysis
      ##########################
      - name: ðŸ§¼ Run PMD Analysis
        run: scripts\run-pmd.bat
        shell: cmd

